<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_saleorder_document" inherit_id="sale.report_saleorder_document">
        <t t-call="report.external_layout" position="attributes">
            <attribute name="t-call"/>
        </t>

        <xpath expr="//div[@class='page']" position="attributes">
            <attribute name="t-attf-class">page company_#{doc.company_id.id}</attribute>
        </xpath>

        <div class="page" position="before">
            <!-- Multicompany -->
            <t t-if="not o and doc">
                <t t-set="o" t-value="doc"/>
            </t>
            <t t-if="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id"/>
            </t>
            <t t-if="not o or not 'company_id' in o">
                <t t-set="company" t-value="res_company"/>
            </t>
            <div t-attf-class="header company_#{company.id}">
                <div class="row">
                    <div class="col-xs-3">
                        <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 100px;"/>
                    </div>
                    <div class="col-xs-9 text-right">
                        <strong><span t-esc="company.partner_id and company.partner_id.name"/></strong>
                            <span t-field="company.partner_id" t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: true}"/>
							<span>HST Registration No. </span><span t-field="company.vat"/>
                    </div>
                </div>
                <div style="width: 100%;">
                    <div class="o_hr" style="height: 6px;float: right;line-height: 0;margin-top: 20px;box-sizing: border-box;width: 100%;font-size: 1px;">0</div>
                </div>
            </div>
        </div>
        <div class="page" position="after">
            <div t-attf-class="footer company_#{company.id}">
                <div class="row">
                    <div class="col-xs-7" ><strong><font>VISIT US ONLINE </font></strong><span t-esc="company.website or ''"/></div>
                    <div class="col-xs-12 o_hr" style="height: 6px;float: right;line-height: 0;margin-top: 10px;box-sizing: border-box;width: 100%;font-size: 1px;">0</div>
                </div>
                <div class="col-xs-5 col-xs-offset-7" style="margin-top:20px;">
                    <div><font style="font-weight: bold; line-height: 24px;">CUSTOMER SERVICE AND TECHNICAL SUPPORT</font></div>
                    <div><font style="line-height: 24px;"><img src="/niche_sale_reports/static/src/img/ico-mails.png" alt="" title="" style="width: 18px; vertical-align: middle;"/><span style="padding-left: 10px;" t-field="company.cs_email"/></font></div>
                    <div><font style="line-height: 24px;"><img src="/niche_sale_reports/static/src/img/ico-phone.png" alt="" title="" style="width: 18px; vertical-align: middle;"/><span style="padding-left: 10px;" t-field="company.cs_phone"/></font></div>
                    <div><font style="line-height: 24px;"><img src="/niche_sale_reports/static/src/img/ico-fax.png" alt="" title="" style="width: 18px; vertical-align: middle;"/><span style="padding-left: 10px;" t-field="company.cs_fax"/></font></div>
                </div>
            </div>
        </div>


        <xpath expr="//div[@class='col-xs-6']//strong[@t-if='doc.partner_shipping_id == doc.partner_invoice_id']" position="attributes">
            <attribute name="class">hidden</attribute>
        </xpath>

        <xpath expr="//div[@class='col-xs-6']//strong[@t-if='doc.partner_shipping_id != doc.partner_invoice_id']" position="attributes">
            <attribute name="t-if"/>
        </xpath>

        <xpath expr="//div[@class='col-xs-6']//div[@t-if='doc.partner_shipping_id != doc.partner_invoice_id']" position="attributes">
            <attribute name="class">hidden</attribute>
        </xpath>
		
         <xpath expr="//div[@class='col-xs-5 col-xs-offset-1']" position="replace">
		    <div class="mt8 col-xs-5 col-xs-offset-1">
                <strong>Shipping Address:</strong>
                <div t-field="doc.partner_shipping_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;, &quot;fax&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
			</div>
        </xpath>
		
        <xpath expr="//div[@name='total']//table[@class='table table-condensed']/tr/td/strong" position="replace">
            <strong>Subtotal</strong>
        </xpath>

        <xpath expr="//table[@class='table table-condensed']" position="attributes">
            <attribute name="class">table</attribute>
        </xpath>

        <xpath expr="//div[@class='row']/div[@class='col-xs-4 pull-right']/table[@class='table table-condensed']/tr[1]"
               position="attributes">
            <attribute name="class" />
        </xpath>

        <xpath expr="//div[@class='col-xs-4 pull-right']//table[@class='table table-condensed']" position="attributes">
            <attribute name="class">table</attribute>
        </xpath>

        <xpath expr="//t[@t-foreach='doc.order_lines_layouted()']" position="before">
            <table t-attf-class="table">
                <thead>
                    <tr>
                        <th >Date Ordered</th>
                        <th >Delivery method</th>
                        <th >Payment terms</th>
                        <th >Ships From </th>
                    </tr>
               </thead>
               <tbody class="sale_tbody">
                    <tr>
                        <td><span t-field="doc.date_order"/></td>
                        <td><span t-field="doc.carrier_id"/></td>
                        <td><span t-field="doc.payment_term_id"/></td>
                        <td><span t-field="doc.warehouse_id"/></td>
                    </tr>
                </tbody>
            </table>
        </xpath>

        <xpath expr="//div[@t-if='doc.date_order']" position="attributes">
            <attribute name="class">hidden</attribute>
        </xpath>

        <xpath expr="//div[@name='payment_term']" position="attributes">
            <attribute name="class">hidden</attribute>
        </xpath>

        <xpath expr="//t[contains(@t-foreach, 'layout_category')]//span[contains(@t-esc, 'l.tax_id')]" position="attributes">
            <attribute name="t-esc">', '.join(map(lambda x: (x.name), l.tax_id))[:7]</attribute>
        </xpath>

        <xpath expr="//span[@t-field='l.price_subtotal']" position="replace">
            <t t-if="doc.pricelist_id.currency_id.name == 'CAD'">
                <span t-esc="'%.2f CAD' % l.price_subtotal"/>
            </t>
            <t t-else="">
                <span t-field="l.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
            </t>
        </xpath>

        <xpath expr="//span[@t-field='doc.amount_untaxed']" position="replace">
            <t t-if="doc.pricelist_id.currency_id.name == 'CAD'">
                <span t-esc="'%.2f CAD' % doc.amount_untaxed"/>
            </t>
            <t t-else="">
                <span t-field="doc.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
            </t>
        </xpath>

        <xpath expr="//t[@t-foreach='doc._get_tax_amount_by_group()']/tr" position="replace">
            <t t-if="doc.currency_id.name == 'CAD'">
                <tr>
                    <td><span t-esc="amount_by_group[0] or 'Taxes'"/></td>
                    <td class="text-right">
                        <span t-esc="amount_by_group[1] and amount_by_group[1].split(' ')[0] + ' CAD' or ''"/>
                    </td>
                </tr>
            </t>
            <t t-else="">
                <tr>
                    <td><span t-esc="amount_by_group[0] or 'Taxes'"/></td>
                    <td class="text-right">
                        <span t-esc="amount_by_group[1]"/>
                    </td>
                </tr>
            </t>
        </xpath>

        <xpath expr="//span[@t-field='doc.amount_total']" position="replace">
            <t t-if="doc.pricelist_id.currency_id.name == 'CAD'">
                <span t-esc="'%.2f CAD' % doc.amount_total"/>
            </t>
            <t t-else="">
                <span t-field="doc.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: doc.pricelist_id.currency_id}"/>
            </t>
        </xpath>
        <xpath expr="//span[contains(@t-if, 'doc.state not in') and contains(@t-if ,'draft')  and contains(@t-if ,'sent')]" position="replace">
            <span t-if="doc.state not in ['draft','sent']">Sale Order # </span>
        </xpath>

    </template>
	
</odoo>